<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1e3c72">
    <meta name="description" content="Sistema de entrenamiento cognitivo Dual N-Back de grado cl√≠nico">
    <meta name="author" content="Vicente Serey">
    <title>Dual N-Back Pro | Entrenamiento Cognitivo Cient√≠fico</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        :root {
            --primary-dark: #1e3c72;
            --primary-mid: #2a5298;
            --primary-light: #4a6fa5;
            --accent-cyan: #00d2ff;
            --accent-blue: #3a7bd5;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --glass-bg: rgba(255, 255, 255, 0.97);
            --shadow-strong: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        html {
            height: 100%;
            height: -webkit-fill-available;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            background-attachment: fixed;
            height: 100vh;
            height: -webkit-fill-available;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #2c3e50;
            overflow: hidden;
            position: fixed;
            width: 100%;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: var(--shadow-strong);
            width: 100%;
            max-width: 1100px;
            height: 100%;
            max-height: 95vh;
            max-height: -webkit-fill-available;
            padding: 1.5rem;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .app-container::-webkit-scrollbar {
            width: 8px;
        }

        .app-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .app-container::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border-radius: 10px;
        }

        .home-btn-fixed {
            position: fixed;
            top: 15px;
            right: 15px;
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.35);
            z-index: 9999;
            border: 3px solid white;
            transition: transform 0.2s;
            touch-action: manipulation;
        }

        .home-btn-fixed:active {
            transform: scale(0.9);
        }

        .screen {
            display: none;
            opacity: 0;
            animation: fadeIn 0.4s ease-in-out forwards;
            padding-bottom: 60px;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            color: var(--primary-dark);
            font-size: clamp(1.8rem, 5vw, 2.8rem);
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 800;
        }

        h2 {
            color: var(--primary-mid);
            font-size: clamp(1.3rem, 4vw, 1.9rem);
            margin: 2.5rem 0 1.2rem;
            border-bottom: 3px solid #e8eaf6;
            padding-bottom: 0.6rem;
            font-weight: 700;
        }

        h3 {
            color: var(--primary-light);
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            margin: 1.8rem 0 0.9rem;
            font-weight: 600;
        }

        p {
            margin-bottom: 1rem;
            line-height: 1.8;
            text-align: justify;
            font-size: clamp(0.9rem, 2.5vw, 1.05rem);
            color: #37474f;
        }

        ul, ol {
            margin-left: 1.8rem;
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        li {
            margin-bottom: 0.6rem;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 14px;
            font-weight: 700;
            font-size: clamp(0.95rem, 2.5vw, 1.1rem);
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(58, 123, 213, 0.35);
            width: 100%;
            margin: 8px 0;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #eceff1;
            color: #37474f;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef5350, #c62828);
        }

        .btn-success {
            background: linear-gradient(135deg, #66bb6a, #2e7d32);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffa726, #ef6c00);
        }

        .btn-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin: 2rem 0;
        }

        .main-action-btn {
            padding: 3rem 2rem;
            font-size: clamp(1.5rem, 4vw, 2rem);
            flex-direction: column;
            min-height: 200px;
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
            box-shadow: 0 8px 24px rgba(67, 160, 71, 0.4);
        }

        .main-action-btn .icon {
            font-size: clamp(3rem, 8vw, 4.5rem);
            margin-bottom: 0.5rem;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: clamp(10px, 2.5vw, 16px);
            max-width: 450px;
            margin: 0 auto 1.5rem;
            padding: clamp(12px, 3vw, 20px);
            background: #f5f7fa;
            border-radius: 20px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.06);
        }

        .grid-cell {
            aspect-ratio: 1;
            background: white;
            border-radius: 14px;
            border: 3px solid transparent;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            justify-content: center;
            align-items: center;
            color: transparent;
            font-size: 0;
            position: relative;
        }

        .grid-cell::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 11px;
            opacity: 0;
            background: linear-gradient(135deg, #3f51b5, #5c6bc0);
            transition: opacity 0.2s;
        }

        .grid-cell.active::after {
            opacity: 1;
        }

        .grid-cell.active {
            transform: scale(0.92);
            box-shadow: 0 0 20px rgba(63, 81, 181, 0.6);
            border-color: var(--accent-cyan);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
            gap: 0.8rem;
        }

        .level-badge {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-mid));
            color: white;
            padding: 8px 18px;
            border-radius: 20px;
            font-weight: 700;
            font-size: clamp(0.9rem, 2.5vw, 1.05rem);
            box-shadow: 0 3px 10px rgba(30, 60, 114, 0.3);
        }

        .mode-badge {
            background: var(--warning);
            color: white;
            padding: 6px 14px;
            border-radius: 15px;
            font-weight: 600;
            font-size: clamp(0.8rem, 2vw, 0.95rem);
        }

        .realtime-score {
            display: flex;
            justify-content: space-around;
            gap: 1rem;
            background: white;
            padding: 14px;
            border-radius: 14px;
            margin-bottom: 1.2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: opacity 0.3s, transform 0.3s;
        }

        body.zen-mode .realtime-score {
            opacity: 0;
            transform: scale(0.9);
            pointer-events: none;
            height: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        .score-item {
            text-align: center;
            flex: 1;
        }

        .score-value {
            font-size: clamp(1.8rem, 5vw, 2.4rem);
            font-weight: 800;
            margin-bottom: 0.4rem;
        }

        .score-value.hits {
            color: var(--success);
        }

        .score-value.errors {
            color: var(--error);
        }

        .score-label {
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .feedback-btn {
            min-height: 90px;
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            flex-direction: column;
            gap: 6px;
        }

        .feedback-btn.matched {
            animation: feedback-pulse 0.3s ease;
        }

        body.zen-mode .feedback-btn.matched {
            animation: none;
        }

        @keyframes feedback-pulse {
            0% { transform: scale(1); }
            50% { 
                transform: scale(1.08); 
                background: linear-gradient(135deg, var(--success), #66bb6a);
                box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
            }
            100% { transform: scale(1); }
        }

        .academic-box {
            background: #f8f9fa;
            border-left: 4px solid var(--accent-blue);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 12px 12px 0;
            font-size: clamp(0.88rem, 2.2vw, 1rem);
            line-height: 1.8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .academic-box.adhd-highlight {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left-color: #ff9800;
            border: 2px solid #ff9800;
            border-radius: 12px;
        }

        .academic-box.success-box {
            border-left-color: var(--success);
            background: #e8f5e9;
        }

        .academic-box.info-box {
            border-left-color: #2196f3;
            background: #e3f2fd;
        }

        .citation {
            font-size: clamp(0.75rem, 1.9vw, 0.88rem);
            color: #666;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
            font-style: italic;
            line-height: 1.6;
        }

        .config-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 1.2rem;
            border-radius: 14px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .config-info {
            flex: 1;
        }

        .config-info strong {
            display: block;
            margin-bottom: 0.3rem;
            font-size: clamp(1rem, 2.5vw, 1.1rem);
            color: var(--primary-dark);
        }

        .config-info small {
            color: #666;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            line-height: 1.4;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 54px;
            height: 30px;
            flex-shrink: 0;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider {
            background-color: var(--success);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .level-selector {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 2rem 0;
        }

        .level-btn {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 700;
            font-size: clamp(1.2rem, 3vw, 1.5rem);
            color: var(--primary-dark);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .level-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .level-btn.selected {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            color: white;
            border-color: var(--accent-cyan);
            box-shadow: 0 4px 16px rgba(58, 123, 213, 0.4);
        }

        .level-btn.locked {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .level-btn small {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .device-selection {
            padding: 2rem 1rem;
            text-align: center;
        }

        .device-title {
            font-size: clamp(2.2rem, 6vw, 3.5rem);
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1.5rem;
            font-weight: 900;
        }

        .device-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .device-card {
            background: white;
            padding: 2.5rem 2rem;
            border-radius: 20px;
            cursor: pointer;
            border: 4px solid transparent;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .device-card:active {
            transform: scale(0.98);
            border-color: var(--accent-blue);
        }

        .device-card-icon {
            font-size: clamp(4rem, 10vw, 5.5rem);
            margin-bottom: 1.2rem;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.5rem 1rem;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            text-align: center;
        }

        .stat-value {
            font-size: clamp(2rem, 6vw, 2.8rem);
            font-weight: 800;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        thead {
            background: #f5f7fa;
        }

        th, td {
            padding: clamp(10px, 2.5vw, 14px);
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
        }

        th {
            font-weight: 700;
            color: var(--primary-dark);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
                border-radius: 16px;
            }

            .home-btn-fixed {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }

            .menu-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .app-container {
                padding: 0.8rem;
                max-height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div class="home-btn-fixed" onclick="app.goHome()" title="Men√∫ Principal">üè†</div>

    <div class="app-container">
        
        <!-- PANTALLA: SELECCI√ìN DE DISPOSITIVO -->
        <div id="screen-device" class="screen active">
            <div class="device-selection">
                <h1 class="device-title">üß† Dual N-Back Pro</h1>
                <p style="text-align: center; color: #666; font-size: clamp(1rem, 2.5vw, 1.2rem); margin-bottom: 3rem;">
                    Sistema de Entrenamiento de Memoria de Trabajo<br>
                    <small>Selecciona tu dispositivo para optimizar controles y audio</small>
                </p>
                
                <div class="device-options">
                    <div class="device-card" onclick="app.selectDevice('desktop')">
                        <div class="device-card-icon">üíª</div>
                        <div style="font-size: clamp(1.3rem, 3.5vw, 1.7rem); font-weight: 700; margin-bottom: 0.5rem;">Computador</div>
                        <p style="text-align: center;">Control con teclado (Flechas ‚ñ≤‚ñº)</p>
                    </div>
                    
                    <div class="device-card" onclick="app.selectDevice('mobile')">
                        <div class="device-card-icon">üì±</div>
                        <div style="font-size: clamp(1.3rem, 3.5vw, 1.7rem); font-weight: 700; margin-bottom: 0.5rem;">Smartphone</div>
                        <p style="text-align: center;">Botones t√°ctiles optimizados</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- PANTALLA: HOME/MEN√ö PRINCIPAL -->
        <div id="screen-home" class="screen">
            <div style="text-align: center; padding: 2rem 1rem;">
                <h1 style="font-size: clamp(2.5rem, 8vw, 4rem); margin-bottom: 0.5rem;">üß† Dual N-Back</h1>
                <p style="font-style: italic; color: #546e7a; font-size: clamp(1rem, 2.5vw, 1.2rem); margin: 1.5rem 0; text-align: center;">
                    "El entrenamiento de la memoria de trabajo es a la mente lo que el ejercicio f√≠sico es al cuerpo"
                </p>

                <button class="main-action-btn" onclick="app.showLevelSelector()">
                    <div class="icon">üéÆ</div>
                    <div>ENTRENAR</div>
                    <small style="opacity: 0.9; font-weight: 500;">Iniciar sesi√≥n de entrenamiento</small>
                </button>

                <div class="menu-grid">
                    <button class="btn btn-secondary" onclick="app.showScreen('screen-instructions')">
                        üìñ Instrucciones
                    </button>
                    <button class="btn btn-secondary" onclick="app.showScreen('screen-config')">
                        ‚öôÔ∏è Configuraci√≥n
                    </button>
                    <button class="btn btn-secondary" onclick="app.showScreen('screen-history')">
                        üìä An√°lisis
                    </button>
                    <button class="btn btn-secondary" onclick="app.showScreen('screen-science')">
                        üî¨ Base Cient√≠fica
                    </button>
                </div>
            </div>
        </div>

        <!-- PANTALLA: SELECTOR DE NIVEL -->
        <div id="screen-level-select" class="screen">
            <h1>üìä Selecci√≥n de Nivel</h1>
            
            <div class="academic-box info-box">
                <p><strong>Nivel M√°ximo Alcanzado:</strong> <span id="max-level-reached">1</span>-Back</p>
                <p style="margin-bottom: 0;"><small>Solo puedes entrenar en el nivel actual o niveles anteriores para consolidar el aprendizaje.</small></p>
            </div>

            <div class="level-selector" id="level-selector"></div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="app.startGameWithSelectedLevel()">
                    ‚ñ∂Ô∏è Comenzar Entrenamiento
                </button>
                <button class="btn btn-secondary" onclick="app.goHome()">
                    üè† Volver al Men√∫
                </button>
            </div>
        </div>

        <!-- PANTALLA: CONFIGURACI√ìN -->
        <div id="screen-config" class="screen">
            <h1>‚öôÔ∏è Configuraci√≥n</h1>

            <h2>Modos de Entrenamiento</h2>
            
            <div class="config-row">
                <div class="config-info">
                    <strong>üßò Modo Zen</strong>
                    <small>Oculta el score en tiempo real y feedback visual. Mayor validez ecol√≥gica para entrenamiento avanzado.</small>
                </div>
                <label class="switch">
                    <input type="checkbox" id="toggle-zen" onchange="app.toggleZen()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="config-row">
                <div class="config-info">
                    <strong>‚ö° Modo R√°pido</strong>
                    <small>Intervalo de 1500ms en lugar de 3000ms. Solo recomendado para usuarios experimentados (nivel ‚â•4).</small>
                </div>
                <label class="switch">
                    <input type="checkbox" id="toggle-fast" onchange="app.toggleFast()">
                    <span class="slider"></span>
                </label>
            </div>

            <h2>Gesti√≥n de Datos</h2>
            <div class="btn-group">
                <button class="btn btn-warning" onclick="app.exportData()">
                    üì§ Exportar Datos (JSON)
                </button>
                <button class="btn" onclick="document.getElementById('import-file').click()">
                    üì• Importar Datos
                </button>
                <input type="file" id="import-file" accept=".json" style="display:none;" onchange="app.importData(event)">
            </div>

            <h2>Prueba de Sistema</h2>
            <button class="btn btn-secondary" onclick="app.testAudio()">
                üîä Probar Audio (Obligatorio iOS/Safari)
            </button>

            <div class="btn-group" style="margin-top: 3rem;">
                <button class="btn btn-secondary" onclick="app.goHome()">
                    üè† Volver al Men√∫
                </button>
            </div>

            <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e0e0e0; text-align: center; font-size: 0.9rem; color: #888;">
                <p><strong>Dise√±ado por:</strong> Vicente Serey</p>
            </footer>
        </div>

        <!-- PANTALLA: INSTRUCCIONES -->
        <div id="screen-instructions" class="screen">
            <h1>üìñ Protocolo de Entrenamiento</h1>

            <h2>üéØ Instrucciones B√°sicas del Juego</h2>

            <div class="academic-box success-box">
                <h3>Objetivo</h3>
                <p>Se presentan dos est√≠mulos simult√°neamente cada 3 segundos (o 1.5s en modo r√°pido):</p>
                <ul>
                    <li><strong>Posici√≥n Visual:</strong> Un cuadrado azul se ilumina en la cuadr√≠cula 3√ó3</li>
                    <li><strong>Letra Auditiva:</strong> Escuchar√°s una letra pronunciada (C, H, K, L, Q, R, S, T)</li>
                </ul>
                <p><strong>Tu tarea:</strong> Presionar el bot√≥n correspondiente si el est√≠mulo actual coincide con el que apareci√≥ <strong>N posiciones atr√°s</strong>.</p>
            </div>

            <h3>Controles</h3>
            <div class="academic-box info-box">
                <p><strong id="controls-type">Computador (Teclado)</strong></p>
                <ul id="controls-list">
                    <li><strong>‚ñ≤ Flecha Arriba:</strong> Marcar coincidencia de POSICI√ìN</li>
                    <li><strong>‚ñº Flecha Abajo:</strong> Marcar coincidencia de SONIDO (letra)</li>
                    <li><strong>‚ñ≤ + ‚ñº Simult√°neas:</strong> Ambas coinciden (puedes presionar las dos teclas a la vez)</li>
                </ul>
            </div>

            <h3>Ejemplos de Niveles</h3>
            <div class="academic-box">
                <h4>Nivel 1 (1-Back)</h4>
                <p>Comparas con el est√≠mulo <strong>inmediatamente anterior</strong>. Si la posici√≥n se repite, presiona "Posici√≥n". Si la letra se repite, presiona "Sonido".</p>
                
                <h4>Nivel 2 (2-Back)</h4>
                <p>Comparas con el est√≠mulo de hace <strong>dos turnos</strong>. Debes mantener DOS elementos en memoria simult√°neamente.</p>
                
                <h4>Nivel 3 y superiores</h4>
                <p>La carga cognitiva aumenta exponencialmente. El nivel 4-Back requiere mantener 4 √≠tems duales en memoria activa, nivel similar al de expertos.</p>
            </div>

            <h2>‚öñÔ∏è Criterio Cient√≠fico de Avance</h2>
            <div class="academic-box info-box">
                <p>Este sistema utiliza el criterio cl√≠nico estricto basado en investigaci√≥n:</p>
                <ul>
                    <li><strong>Avanzar al siguiente nivel:</strong> Precisi√≥n ‚â• 85%</li>
                    <li><strong>Mantener nivel actual:</strong> Precisi√≥n 70-84%</li>
                    <li><strong>Considerar nivel inferior:</strong> Precisi√≥n < 70%</li>
                </ul>
                <p style="margin-bottom: 0;"><em>Este criterio asegura la consolidaci√≥n neuropl√°stica real antes de aumentar la carga cognitiva.</em></p>
            </div>

            <h2>üí° Plan √ìptimo de Entrenamiento</h2>
            <div class="academic-box success-box">
                <h4>Protocolo Recomendado</h4>
                <ul>
                    <li><strong>Frecuencia:</strong> 20-25 minutos diarios, 5 d√≠as por semana</li>
                    <li><strong>Ambiente:</strong> Silencioso, sin distracciones auditivas o visuales</li>
                    <li><strong>Auriculares:</strong> Obligatorio para discriminaci√≥n auditiva √≥ptima</li>
                    <li><strong>Duraci√≥n programa:</strong> M√≠nimo 4 semanas, √≥ptimo 8-12 semanas</li>
                    <li><strong>Efectos:</strong> Dependientes de la dosis (Jaeggi et al., 2008)</li>
                </ul>
                
                <h4>Expectativas Realistas</h4>
                <ul>
                    <li><strong>Semanas 1-2:</strong> Familiarizaci√≥n y mejoras r√°pidas iniciales</li>
                    <li><strong>Semanas 3-4:</strong> Meseta temporal normal (continuar es crucial)</li>
                    <li><strong>Semanas 5-8:</strong> Mejoras sostenidas en capacidad de memoria de trabajo</li>
                    <li><strong>Transferencia:</strong> Puede requerir >10 sesiones para observar efectos en tareas no entrenadas</li>
                </ul>
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="app.showLevelSelector()">
                    ‚ñ∂Ô∏è Comenzar Entrenamiento
                </button>
                <button class="btn btn-secondary" onclick="app.goHome()">
                    üè† Volver al Men√∫
                </button>
            </div>

            <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e0e0e0; text-align: center; font-size: 0.9rem; color: #888;">
                <p><strong>Dise√±ado por:</strong> Vicente Serey</p>
            </footer>
        </div>

        <!-- PANTALLA: JUEGO -->
        <div id="screen-game" class="screen">
            <div class="game-header">
                <div>
                    <span class="level-badge" id="game-level-badge">Nivel: 1-Back</span>
                    <span class="mode-badge" id="game-mode-badge" style="display:none;">‚ö° R√°pido</span>
                </div>
                <div style="font-size: clamp(0.85rem, 2vw, 0.95rem); color: #666;">
                    <span>Ronda: <strong id="game-round">0</strong>/<strong id="game-max-rounds">20</strong></span>
                </div>
            </div>

            <div class="realtime-score" id="realtime-score">
                <div class="score-item">
                    <div class="score-value hits" id="score-hits">0</div>
                    <div class="score-label">Aciertos</div>
                </div>
                <div class="score-item">
                    <div class="score-value errors" id="score-errors">0</div>
                    <div class="score-label">Errores</div>
                </div>
            </div>

            <div class="grid-container" id="game-grid"></div>

            <div style="text-align: center; height: 25px; margin-bottom: 15px; color: #999; font-size: clamp(0.75rem, 2vw, 0.85rem);">
                <span id="audio-indicator">üîä Escucha atentamente...</span>
            </div>

            <div id="desktop-controls" style="display: none; justify-content: center; gap: 15px; margin-bottom: 1rem;">
                <button class="btn feedback-btn" id="btn-pos-desk" onclick="game.handleInput('pos')">
                    üìç Posici√≥n<br><small>(Flecha ‚ñ≤)</small>
                </button>
                <button class="btn feedback-btn" id="btn-audio-desk" onclick="game.handleInput('audio')">
                    üîä Sonido<br><small>(Flecha ‚ñº)</small>
                </button>
            </div>

            <div id="mobile-controls" style="display: none; gap: 15px; margin-bottom: 1rem;">
                <button class="btn feedback-btn" id="btn-pos-mobile" ontouchstart="game.handleInput('pos')" onclick="game.handleInput('pos')">
                    üìç Posici√≥n
                </button>
                <button class="btn feedback-btn" id="btn-audio-mobile" ontouchstart="game.handleInput('audio')" onclick="game.handleInput('audio')">
                    üîä Sonido
                </button>
            </div>

            <button class="btn btn-danger" style="margin-top: 2rem; max-width: 250px; margin-left: auto; margin-right: auto;" onclick="app.quitGame()">
                üö™ Salir de la Sesi√≥n
            </button>
        </div>

        <!-- PANTALLA: RESULTADOS -->
        <div id="screen-results" class="screen">
            <h1>üìä Resultados de la Sesi√≥n</h1>

            <div id="result-verdict" class="academic-box" style="text-align: center; font-size: clamp(1.1rem, 3vw, 1.3rem); font-weight: 700; margin-bottom: 2rem;"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="result-accuracy">0%</div>
                    <div class="stat-label">Precisi√≥n</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="result-level">1</div>
                    <div class="stat-label">Nivel</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="result-hits">0</div>
                    <div class="stat-label">Aciertos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="result-errors">0</div>
                    <div class="stat-label">Errores</div>
                </div>
            </div>

            <div style="height: 300px; background: white; padding: 15px; border-radius: 16px; margin: 2rem 0; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <canvas id="result-chart"></canvas>
            </div>

            <div class="btn-group" id="result-buttons"></div>

            <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e0e0e0; text-align: center; font-size: 0.9rem; color: #888;">
                <p><strong>Dise√±ado por:</strong> Vicente Serey</p>
            </footer>
        </div>

        <!-- PANTALLA: HISTORIAL/AN√ÅLISIS -->
        <div id="screen-history" class="screen">
            <h1>üìà An√°lisis de Rendimiento</h1>

            <div id="history-summary" class="stats-grid"></div>

            <h2>Historial por Nivel</h2>
            <div class="academic-box info-box">
                <p style="margin-bottom: 0;"><small>Cada nivel tiene sus propias estad√≠sticas y curvas de aprendizaje. Selecciona un nivel para ver detalles:</small></p>
            </div>

            <div style="display: flex; gap: 8px; flex-wrap: wrap; margin: 1rem 0;">
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel('all')">Todos</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(1)">Nivel 1</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(2)">Nivel 2</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(3)">Nivel 3</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(4)">Nivel 4</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(5)">Nivel 5</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(6)">Nivel 6</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(7)">Nivel 7</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(8)">Nivel 8</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(9)">Nivel 9</button>
                <button class="btn btn-secondary" style="flex: 1; min-width: 80px;" onclick="app.showHistoryForLevel(10)">Nivel 10</button>
            </div>

            <div style="height: 350px; background: white; padding: 15px; border-radius: 16px; margin: 2rem 0; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
                <canvas id="history-chart"></canvas>
            </div>

            <div id="history-table-container"></div>

            <div class="btn-group">
                <button class="btn btn-danger" onclick="app.clearHistory()">
                    üóëÔ∏è Borrar Historial Completo
                </button>
                <button class="btn btn-secondary" onclick="app.goHome()">
                    üè† Volver al Men√∫
                </button>
            </div>

            <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e0e0e0; text-align: center; font-size: 0.9rem; color: #888;">
                <p><strong>Dise√±ado por:</strong> Vicente Serey</p>
            </footer>
        </div>

        <!-- PANTALLA: BASE CIENT√çFICA -->
        <div id="screen-science" class="screen">
            <h1>üî¨ Base Cient√≠fica</h1>

            <div style="font-family: Georgia, 'Times New Roman', serif; font-style: italic; font-size: clamp(0.95rem, 2.3vw, 1.05rem); text-align: justify; color: #263238; padding: 2rem clamp(1rem, 3vw, 2rem); background: linear-gradient(135deg, rgba(58,123,213,0.08) 0%, rgba(0,210,255,0.08) 100%); border-radius: 16px; margin: 2rem 0; line-height: 1.95; box-shadow: 0 4px 16px rgba(0,0,0,0.08);">
                "La memoria de trabajo constituye el escenario temporal donde la consciencia orquesta la danza de la cognici√≥n activa, funcionando como el procesador de informaci√≥n en tiempo real del sistema nervioso humano."
            </div>

            <h2>Fundamentaci√≥n Neurocient√≠fica del Dual N-Back</h2>

            <h3>Memoria de Trabajo: Modelo Multicomponente de Baddeley</h3>
            <div class="academic-box">
                <p>El paradigma dual n-back se ha consolidado como herramienta fundamental para el entrenamiento de la <strong>memoria de trabajo</strong> (working memory capacity, WMC), definida operacionalmente como la capacidad limitada para mantener y manipular activamente informaci√≥n durante per√≠odos breves mientras se ejecutan procesos cognitivos complejos concurrentes (Baddeley, 2012).</p>
                
                <p>Este sistema cognitivo est√° compuesto por tres subsistemas principales seg√∫n el modelo multicomponente propuesto por Baddeley y Hitch (1974): el <strong>ejecutivo central</strong>, responsable de la coordinaci√≥n atencional, control inhibitorio y cambio flexible entre tareas; el <strong>bucle fonol√≥gico</strong>, especializado en el procesamiento y almacenamiento temporal de informaci√≥n auditivo-verbal mediante ensayo subvocal; y la <strong>agenda visuoespacial</strong>, encargada de mantener y manipular informaci√≥n visual y representaciones espaciales.</p>
                
                <p>El entrenamiento dual n-back sobrecarga simult√°neamente el bucle fonol√≥gico (mediante la presentaci√≥n secuencial de letras auditivas) y la agenda visuoespacial (posiciones en cuadr√≠cula 3√ó3), forzando al ejecutivo central a coordinar, actualizar y mantener ambos flujos de informaci√≥n bajo severas restricciones temporales.</p>
                
                <div class="citation">
                    Baddeley, A. (2012). Working memory: Theories, models, and controversies. <em>Annual Review of Psychology, 63</em>, 1-29.
                </div>
            </div>

            <h3>Bases Neurales: Corteza Prefrontal Dorsolateral (DLPFC)</h3>
            <div class="academic-box">
                <p>La neuroimagen funcional mediante resonancia magn√©tica (fMRI) ha identificado consistentemente la <strong>corteza prefrontal dorsolateral (DLPFC)</strong> como regi√≥n cr√≠tica subyacente a la memoria de trabajo. Estudios longitudinales demuestran que la conectividad funcional (FC) basal de la DLPFC predice significativamente las ganancias individuales derivadas del entrenamiento cognitivo (Jost et al., 2021).</p>
                
                <p>Esta regi√≥n exhibe plasticidad estructural y funcional tras entrenamiento sostenido, evidenciada por incrementos mensurables en densidad de materia gris, fortalecimiento de conexiones sin√°pticas, y mayor eficiencia en el reclutamiento neural (Buschkuehl et al., 2012).</p>
                
                <div class="citation">
                    Jost, K., Bryck, R. L., Vogel, E. K., & Mayr, U. (2021). Dorsolateral prefrontal functional connectivity predicts working memory training gains. <em>Frontiers in Aging Neuroscience, 13</em>, 592261.
                </div>
            </div>

            <h3>Transferencia a Inteligencia Fluida</h3>
            <div class="academic-box">
                <p>El estudio seminal de Jaeggi et al. (2008) demostr√≥ que el entrenamiento adaptativo dual n-back produc√≠a mejoras significativas en medidas de inteligencia fluida (Gf), con efectos dependientes de la dosis de entrenamiento (m√°s d√≠as de pr√°ctica = mayor transferencia). Este hallazgo revolucionario desafi√≥ la concepci√≥n tradicional de inteligencia como rasgo est√°tico inmutable.</p>
                
                <p>Un meta-an√°lisis comprehensivo de Soveri et al. (2017) que integr√≥ 33 estudios (N=1,417 participantes) concluy√≥ que el entrenamiento n-back produce efectos robustos en tareas de criterio entrenadas y transferencia cercana, con evidencia moderada de transferencia a inteligencia fluida (Hedge's g = 0.19, IC 95%: 0.03-0.35).</p>
                
                <div class="citation">
                    Jaeggi, S. M., Buschkuehl, M., Jonides, J., & Perrig, W. J. (2008). Improving fluid intelligence with training on working memory. <em>Proceedings of the National Academy of Sciences, 105</em>(19), 6829-6833.
                </div>
            </div>

            <h2>‚ö†Ô∏è Relevancia Cl√≠nica para TDAH</h2>
            <div class="academic-box adhd-highlight">
                <p><strong>El creador de este programa padece Trastorno por D√©ficit de Atenci√≥n e Hiperactividad (TDAH)</strong>, condici√≥n neurocognitiva caracterizada por d√©ficits persistentes en atenci√≥n sostenida, control inhibitorio, y cr√≠ticamente, <strong>memoria de trabajo</strong>.</p>
                
                <p>Investigaciones meta-anal√≠ticas de gran escala revelan que el TDAH est√° asociado con deterioros de magnitud muy grande en memoria de trabajo. Kasper et al. (2012) reportaron tama√±os del efecto de d=2.01‚Äì2.15, sugiriendo que aproximadamente 75-85% de ni√±os con TDAH presentan d√©ficits significativos en memoria de trabajo.</p>
                
                <p>Crucialmente, investigaci√≥n reciente (Martin et al., 2024) demuestra que los d√©ficits de memoria de trabajo en TDAH representan un <em>mecanismo causal</em> que genera deterioros secundarios en control inhibitorio y rendimiento acad√©mico, m√°s que un mero epifen√≥meno.</p>
                
                <p>Estudios controlados aleatorizados demuestran que el entrenamiento n-back puede ser efectivo para abordar d√©ficits cognitivos en TDAH. Beck et al. (2020) encontraron que ni√±os con TDAH (7-14 a√±os) que entrenaron en n-back durante m√∫ltiples sesiones demostraron transferencia de entrenamiento a una tarea n-back no entrenada y, cr√≠ticamente, a una medida de control inhibitorio (CPT).</p>
                
                <div class="citation">
                    Beck, S. J., Hanson, C. A., Puffenberger, S. S., Benninger, K. L., & Benninger, W. B. (2020). Exploring N-back cognitive training for children with ADHD. <em>Journal of Attention Disorders, 24</em>(5), 704-719.
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" onclick="app.goHome()">
                    üè† Volver al Men√∫
                </button>
            </div>

            <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e0e0e0; text-align: center; font-size: 0.9rem; color: #888;">
                <p><strong>Dise√±ado por:</strong> Vicente Serey</p>
            </footer>
        </div>

    </div>

    <script>
        /**
         * DUAL N-BACK PRO - JAVASCRIPT ENGINE
         * Sistema de Entrenamiento Cognitivo Cient√≠fico
         * Autor: Vicente Serey
         */

        /**
         * GENERADOR ALEATORIO AVANZADO
         * Mersenne Twister (simplificado)
         * Algoritmo sofisticado para distribuci√≥n aleatoria no predecible
         */
        class AdvancedRNG {
            constructor(seed = Date.now()) {
                this.seed = seed | 0;
            }

            // Mulberry32 - Generador pseudo-aleatorio de alta calidad
            next() {
                let t = this.seed += 0x6D2B79F5;
                t = Math.imul(t ^ (t >>> 15), t | 1);
                t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
                return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
            }

            // Generar entero entre min y max (inclusive)
            nextInt(min, max) {
                return Math.floor(this.next() * (max - min + 1)) + min;
            }

            // Decidir si crear match (distribuci√≥n estrat√©gica por nivel)
            shouldCreateMatch(nLevel, sequenceLength) {
                if (sequenceLength < nLevel) return false;

                // Probabilidad base ajustada por nivel
                // Nivel 1-2: 35-40%
                // Nivel 3-5: 40-45%
                // Nivel 6-10: 45-50%
                const baseProbability = 0.35 + Math.min(nLevel * 0.015, 0.15);
                return this.next() < baseProbability;
            }

            // Tipo de match: solo posici√≥n, solo audio, o ambos
            getMatchType() {
                const rand = this.next();
                if (rand < 0.40) return 'position';    // 40%
                if (rand < 0.80) return 'audio';       // 40%
                return 'both';                         // 20% probabilidad de match dual
            }

            // Resetear semilla (nuevo juego)
            reset() {
                this.seed = (Date.now() + Math.random() * 1000000) | 0;
            }
        }

        /**
         * CONTROLADOR DE AUDIO OPTIMIZADO PARA iOS/ANDROID
         * Soluciona problemas de latencia y bloqueo en m√≥viles
         */
        const AudioEngine = {
            ctx: null,
            synth: window.speechSynthesis,
            voices: [],
            isUnlocked: false,
            currentOscillator: null,

            init() {
                try {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    this.ctx = new AudioContext();
                } catch (e) {
                    console.warn('Web Audio API no soportada');
                }

                // Cargar voces
                const loadVoices = () => {
                    this.voices = this.synth.getVoices();
                };

                if (this.synth.onvoiceschanged !== undefined) {
                    this.synth.onvoiceschanged = loadVoices;
                }
                loadVoices();
            },

            // CR√çTICO: Desbloquear audio en primer toque (iOS/Safari)
            unlock() {
                if (this.isUnlocked) return;

                // Reanudar contexto si est√° suspendido
                if (this.ctx && this.ctx.state === 'suspended') {
                    this.ctx.resume().then(() => {
                        console.log('üîä Audio Context desbloqueado');
                        this.isUnlocked = true;
                    });
                }

                // Reproducir silencio para "calentar" el hardware
                if (this.ctx) {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    gain.gain.value = 0.001;
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start(0);
                    osc.stop(0.1);
                }

                // Inicializar s√≠ntesis de voz (iOS necesita esto)
                const u = new SpeechSynthesisUtterance('');
                this.synth.speak(u);

                this.isUnlocked = true;
            },

            // Reproducir tono asociado a letra
            playTone(letter) {
                if (!this.ctx) return;

                // Detener oscilador anterior si existe
                if (this.currentOscillator) {
                    try {
                        this.currentOscillator.stop();
                    } catch(e) {}
                }

                // Frecuencias √∫nicas por letra (escala pentat√≥nica para evitar disonancia)
                const freqMap = {
                    'C': 261.63, 'H': 293.66, 'K': 329.63, 'L': 349.23,
                    'Q': 392.00, 'R': 440.00, 'S': 493.88, 'T': 523.25
                };
                const freq = freqMap[letter] || 440;

                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();

                osc.type = 'sine';
                osc.frequency.value = freq;

                // Envolvente ADSR suave
                const now = this.ctx.currentTime;
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.12, now + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.35);

                osc.connect(gain);
                gain.connect(this.ctx.destination);

                osc.start(now);
                osc.stop(now + 0.4);

                this.currentOscillator = osc;

                setTimeout(() => {
                    this.currentOscillator = null;
                }, 450);
            },

            // Hablar letra (s√≠ntesis de voz)
            speak(letter) {
                // Cancelar cola anterior (cr√≠tico para evitar lag en Android)
                this.synth.cancel();

                const utterance = new SpeechSynthesisUtterance(letter);
                utterance.rate = 1.1;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                utterance.lang = 'es-ES';

                // Seleccionar voz en espa√±ol
                const esVoice = this.voices.find(v => v.lang.includes('es-ES')) || 
                               this.voices.find(v => v.lang.includes('es'));
                if (esVoice) {
                    utterance.voice = esVoice;
                }

                this.synth.speak(utterance);

                // Refuerzo con tono (por si falla la voz)
                this.playTone(letter);
            },

            // Detener todo
            stop() {
                this.synth.cancel();
                if (this.currentOscillator) {
                    try {
                        this.currentOscillator.stop();
                        this.currentOscillator = null;
                    } catch(e) {}
                }
            }
        };

        /**
         * MOTOR DEL JUEGO - DUAL N-BACK ENGINE
         * Maneja la l√≥gica principal del entrenamiento
         */
        const game = {
            // Estado del juego
            level: 1,
            rounds: 20,
            currentRound: 0,
            sequence: [], // [{pos: 2, letter: 'C', matchPos: false, matchAudio: false}]
            isPlaying: false,
            timer: null,
            
            // Estado de inputs del usuario (permite presionar ambos simult√°neamente)
            currentInput: {
                pos: false,
                audio: false,
                timestamp: 0
            },
            
            // Estad√≠sticas
            stats: {
                hits: 0,
                errors: 0,
                totalTargets: 0,
                responseTimes: []
            },
            
            // Configuraci√≥n
            config: {
                zen: false,
                fast: false,
                intervalTime: 3000
            },
            
            // RNG
            rng: new AdvancedRNG(),
            
            // Letras distintivas (fon√©ticamente claras)
            letters: ['C', 'H', 'K', 'L', 'Q', 'R', 'S', 'T'],
            
            // Historial de posiciones/letras recientes (para evitar repeticiones inmediatas)
            recentPositions: [],
            recentLetters: [],

            /**
             * INICIAR JUEGO
             */
            start(level) {
                this.level = level;
                this.currentRound = 0;
                this.sequence = [];
                this.isPlaying = true;
                this.recentPositions = [];
                this.recentLetters = [];

                // Resetear stats
                this.stats = {
                    hits: 0,
                    errors: 0,
                    totalTargets: 0,
                    responseTimes: []
                };

                // Configurar intervalo
                this.config.intervalTime = this.config.fast ? 1500 : 3000;

                // Resetear RNG con semilla aleatoria
                this.rng.reset();

                // Actualizar UI
                document.getElementById('game-level-badge').textContent = `Nivel ${this.level}-Back`;
                document.getElementById('game-mode-badge').style.display = this.config.fast ? 'inline-block' : 'none';
                document.getElementById('score-hits').textContent = '0';
                document.getElementById('score-errors').textContent = '0';
                document.getElementById('game-round').textContent = '0';
                document.getElementById('game-max-rounds').textContent = this.rounds;

                // Aplicar Modo Zen
                if (this.config.zen) {
                    document.body.classList.add('zen-mode');
                } else {
                    document.body.classList.remove('zen-mode');
                }

                // Generar grid
                this.generateGrid();

                // Iniciar primera ronda despu√©s de delay
                setTimeout(() => this.nextRound(), 1000);
            },

            /**
             * GENERAR GRID 3x3
             */
            generateGrid() {
                const container = document.getElementById('game-grid');
                container.innerHTML = '';

                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.id = `cell-${i}`;
                    // SIN TEXTO (requerimiento cr√≠tico)
                    cell.textContent = '';
                    container.appendChild(cell);
                }
            },

            /**
             * SIGUIENTE RONDA
             */
            nextRound() {
                if (!this.isPlaying) return;

                // Evaluar ronda anterior
                if (this.currentRound > 0) {
                    this.evaluatePreviousRound();
                }

                // Verificar fin del juego
                if (this.currentRound >= this.rounds) {
                    this.finish();
                    return;
                }

                // GENERAR EST√çMULO CON ALGORITMO SOFISTICADO
                const shouldMatch = this.rng.shouldCreateMatch(this.level, this.sequence.length);
                let pos, letter, matchPos = false, matchAudio = false;

                if (shouldMatch && this.sequence.length >= this.level) {
                    const targetIdx = this.sequence.length - this.level;
                    const target = this.sequence[targetIdx];
                    const matchType = this.rng.getMatchType();

                    if (matchType === 'position') {
                        pos = target.pos;
                        letter = this.getRandomLetter(true);
                        matchPos = true;
                    } else if (matchType === 'audio') {
                        pos = this.getRandomPosition(true);
                        letter = target.letter;
                        matchAudio = true;
                    } else { // both
                        pos = target.pos;
                        letter = target.letter;
                        matchPos = true;
                        matchAudio = true;
                    }
                } else {
                    // Sin match intencional
                    pos = this.getRandomPosition(true);
                    letter = this.getRandomLetter(true);

                    // Verificar si coincide accidentalmente
                    if (this.sequence.length >= this.level) {
                        const targetIdx = this.sequence.length - this.level;
                        const target = this.sequence[targetIdx];
                        if (target.pos === pos) matchPos = true;
                        if (target.letter === letter) matchAudio = true;
                    }
                }

                // Guardar en secuencia
                this.sequence.push({
                    pos: pos,
                    letter: letter,
                    matchPos: matchPos,
                    matchAudio: matchAudio,
                    userInputPos: false,
                    userInputAudio: false,
                    inputTimestamp: 0
                });

                // Resetear input del usuario
                this.currentInput = {
                    pos: false,
                    audio: false,
                    timestamp: Date.now()
                };

                // Mostrar est√≠mulo
                this.showStimulus(pos, letter);

                // Actualizar contador de ronda
                this.currentRound++;
                document.getElementById('game-round').textContent = this.currentRound;

                // Programar siguiente ronda
                this.timer = setTimeout(() => {
                    this.hideStimulus();
                    setTimeout(() => this.nextRound(), 500);
                }, this.config.intervalTime);
            },

            /**
             * OBTENER POSICI√ìN ALEATORIA (evitando repeticiones inmediatas)
             */
            getRandomPosition(avoidRecent = true) {
                let pos;
                let attempts = 0;

                do {
                    pos = this.rng.nextInt(0, 8);
                    attempts++;
                } while (avoidRecent && 
                         this.recentPositions.length > 0 && 
                         pos === this.recentPositions[this.recentPositions.length - 1] && 
                         attempts < 10);

                this.recentPositions.push(pos);
                if (this.recentPositions.length > 3) this.recentPositions.shift();

                return pos;
            },

            /**
             * OBTENER LETRA ALEATORIA (evitando repeticiones inmediatas)
             */
            getRandomLetter(avoidRecent = true) {
                let letter;
                let attempts = 0;

                do {
                    const idx = this.rng.nextInt(0, this.letters.length - 1);
                    letter = this.letters[idx];
                    attempts++;
                } while (avoidRecent && 
                         this.recentLetters.length > 0 && 
                         letter === this.recentLetters[this.recentLetters.length - 1] && 
                         attempts < 10);

                this.recentLetters.push(letter);
                if (this.recentLetters.length > 3) this.recentLetters.shift();

                return letter;
            },

            /**
             * MOSTRAR EST√çMULO (visual + audio)
             */
            showStimulus(pos, letter) {
                // Activar celda
                this.hideStimulus();
                const cell = document.getElementById(`cell-${pos}`);
                if (cell) {
                    cell.classList.add('active');
                }

                // Reproducir audio
                AudioEngine.speak(letter);

                // Actualizar indicador
                document.getElementById('audio-indicator').textContent = `üîä ${letter}`;
            },

            /**
             * OCULTAR EST√çMULO
             */
            hideStimulus() {
                document.querySelectorAll('.grid-cell').forEach(cell => {
                    cell.classList.remove('active');
                });
                document.getElementById('audio-indicator').textContent = 'üîä Escucha atentamente...';
            },

            /**
             * MANEJAR INPUT DEL USUARIO (permite presionar ambos simult√°neamente)
             */
            handleInput(type) {
                if (!this.isPlaying) return;
                if (this.sequence.length === 0) return;

                const currentIdx = this.sequence.length - 1;
                const rt = Date.now() - this.currentInput.timestamp;

                // Registrar input
                if (type === 'pos') {
                    this.currentInput.pos = true;
                    this.sequence[currentIdx].userInputPos = true;
                    this.sequence[currentIdx].inputTimestamp = rt;
                } else if (type === 'audio') {
                    this.currentInput.audio = true;
                    this.sequence[currentIdx].userInputAudio = true;
                    this.sequence[currentIdx].inputTimestamp = rt;
                }

                // Feedback visual (si NO est√° en Modo Zen)
                if (!this.config.zen) {
                    const btnId = app.device === 'desktop' ? 
                        (type === 'pos' ? 'btn-pos-desk' : 'btn-audio-desk') :
                        (type === 'pos' ? 'btn-pos-mobile' : 'btn-audio-mobile');
                    
                    const btn = document.getElementById(btnId);
                    if (btn) {
                        btn.classList.add('matched');
                        setTimeout(() => btn.classList.remove('matched'), 300);
                    }
                }

                // Feedback h√°ptico (m√≥viles)
                if (app.device === 'mobile' && 'vibrate' in navigator) {
                    navigator.vibrate(30);
                }

                // Guardar tiempo de respuesta
                if (rt > 0 && rt < this.config.intervalTime) {
                    this.stats.responseTimes.push(rt);
                }
            },

            /**
             * EVALUAR RONDA ANTERIOR
             */
            evaluatePreviousRound() {
                const idx = this.sequence.length - 1;

                // Solo evaluar si ya pasamos el nivel N
                if (idx < this.level) return;

                const round = this.sequence[idx];

                // Evaluar POSICI√ìN
                if (round.matchPos) {
                    // Hab√≠a match de posici√≥n
                    if (round.userInputPos) {
                        this.stats.hits++; // Hit correcto
                    } else {
                        this.stats.errors++; // Miss (no respondi√≥)
                    }
                    this.stats.totalTargets++;
                } else {
                    // NO hab√≠a match de posici√≥n
                    if (round.userInputPos) {
                        this.stats.errors++; // Falsa alarma
                    }
                }

                // Evaluar AUDIO
                if (round.matchAudio) {
                    // Hab√≠a match de audio
                    if (round.userInputAudio) {
                        this.stats.hits++; // Hit correcto
                    } else {
                        this.stats.errors++; // Miss (no respondi√≥)
                    }
                    this.stats.totalTargets++;
                } else {
                    // NO hab√≠a match de audio
                    if (round.userInputAudio) {
                        this.stats.errors++; // Falsa alarma
                    }
                }

                // Actualizar UI (si NO est√° en Modo Zen)
                if (!this.config.zen) {
                    document.getElementById('score-hits').textContent = this.stats.hits;
                    document.getElementById('score-errors').textContent = this.stats.errors;
                }
            },

            /**
             * FINALIZAR JUEGO
             */
            finish() {
                this.isPlaying = false;
                clearTimeout(this.timer);
                AudioEngine.stop();

                // Calcular precisi√≥n cient√≠fica
                // Precisi√≥n = Hits / (Hits + Errors) * 100
                const totalResponses = this.stats.hits + this.stats.errors;
                const accuracy = totalResponses > 0 ? 
                    Math.round((this.stats.hits / totalResponses) * 100) : 0;

                // Latencia media
                const avgLatency = this.stats.responseTimes.length > 0 ?
                    Math.round(this.stats.responseTimes.reduce((a, b) => a + b, 0) / this.stats.responseTimes.length) : 0;

                // Guardar sesi√≥n
                app.saveSession({
                    level: this.level,
                    accuracy: accuracy,
                    hits: this.stats.hits,
                    errors: this.stats.errors,
                    avgLatency: avgLatency,
                    mode: this.config.fast ? 'fast' : 'standard',
                    zen: this.config.zen,
                    date: new Date().toISOString()
                });

                // Mostrar resultados
                app.showResults({
                    level: this.level,
                    accuracy: accuracy,
                    hits: this.stats.hits,
                    errors: this.stats.errors,
                    avgLatency: avgLatency
                });
            },

            /**
             * DETENER JUEGO
             */
            stop() {
                this.isPlaying = false;
                clearTimeout(this.timer);
                AudioEngine.stop();
                this.hideStimulus();
            }
        };
        /**
         * CONTROLADOR PRINCIPAL DE LA APLICACI√ìN
         * Maneja navegaci√≥n, configuraci√≥n y gesti√≥n de datos
         */
        const app = {
            device: null,
            selectedLevel: 1,
            maxLevelReached: 1,
            resultChart: null,
            historyChart: null,

            /**
             * INICIALIZACI√ìN
             */
            init() {
                // Cargar configuraci√≥n guardada
                this.loadConfig();

                // Cargar nivel m√°ximo alcanzado
                this.loadMaxLevel();

                // Inicializar Audio Engine
                AudioEngine.init();

                // Detectar dispositivo autom√°ticamente si ya se seleccion√≥ antes
                const savedDevice = localStorage.getItem('nback_device');
                if (savedDevice) {
                    this.device = savedDevice;
                    this.setupControls();
                }

                // Event listener para teclado (desktop)
                document.addEventListener('keydown', (e) => {
                    if (this.device === 'desktop' && game.isPlaying) {
                        if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            game.handleInput('pos');
                        } else if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            game.handleInput('audio');
                        }
                    }
                });

                console.log('‚úÖ Aplicaci√≥n inicializada correctamente');
            },

            /**
             * SELECCIONAR DISPOSITIVO
             */
            selectDevice(type) {
                this.device = type;
                localStorage.setItem('nback_device', type);

                // Desbloquear audio en m√≥viles
                AudioEngine.unlock();

                // Configurar controles
                this.setupControls();

                // Mostrar pantalla home
                this.showScreen('screen-home');

                console.log(`üì± Dispositivo seleccionado: ${type}`);
            },

            /**
             * CONFIGURAR CONTROLES SEG√öN DISPOSITIVO
             */
            setupControls() {
                const desktopControls = document.getElementById('desktop-controls');
                const mobileControls = document.getElementById('mobile-controls');

                if (this.device === 'desktop') {
                    desktopControls.style.display = 'flex';
                    mobileControls.style.display = 'none';
                    document.getElementById('controls-type').textContent = 'Computador (Teclado)';
                    document.getElementById('controls-list').innerHTML = `
                        <li><strong>‚ñ≤ Flecha Arriba:</strong> Marcar coincidencia de POSICI√ìN</li>
                        <li><strong>‚ñº Flecha Abajo:</strong> Marcar coincidencia de SONIDO (letra)</li>
                        <li><strong>‚ñ≤ + ‚ñº Simult√°neas:</strong> Ambas coinciden (puedes presionar las dos teclas a la vez)</li>
                    `;
                } else {
                    desktopControls.style.display = 'none';
                    mobileControls.style.display = 'grid';
                    document.getElementById('controls-type').textContent = 'Smartphone (T√°ctil)';
                    document.getElementById('controls-list').innerHTML = `
                        <li><strong>Bot√≥n "Posici√≥n":</strong> Marcar coincidencia de POSICI√ìN</li>
                        <li><strong>Bot√≥n "Sonido":</strong> Marcar coincidencia de SONIDO (letra)</li>
                        <li><strong>Ambos botones:</strong> Puedes presionar ambos simult√°neamente si coinciden las dos modalidades</li>
                    `;
                }
            },

            /**
             * MOSTRAR PANTALLA
             */
            showScreen(screenId) {
                // Ocultar todas las pantallas
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });

                // Mostrar pantalla seleccionada
                const screen = document.getElementById(screenId);
                if (screen) {
                    screen.classList.add('active');
                    
                    // Scroll al inicio
                    document.querySelector('.app-container').scrollTop = 0;
                }

                // Ocultar bot√≥n home en pantalla de dispositivo
                const homeBtn = document.querySelector('.home-btn-fixed');
                if (screenId === 'screen-device') {
                    homeBtn.style.display = 'none';
                } else {
                    homeBtn.style.display = 'flex';
                }
            },

            /**
             * VOLVER AL HOME
             */
            goHome() {
                // Detener juego si est√° activo
                if (game.isPlaying) {
                    if (confirm('¬øSeguro que deseas salir? Se perder√° el progreso de esta sesi√≥n.')) {
                        game.stop();
                        this.showScreen('screen-home');
                    }
                } else {
                    this.showScreen('screen-home');
                }
            },

            /**
             * MOSTRAR SELECTOR DE NIVEL
             */
            showLevelSelector() {
                this.showScreen('screen-level-select');
                this.renderLevelSelector();
            },

            /**
             * RENDERIZAR SELECTOR DE NIVEL
             */
            renderLevelSelector() {
                const container = document.getElementById('level-selector');
                container.innerHTML = '';

                // Actualizar texto de nivel m√°ximo
                document.getElementById('max-level-reached').textContent = this.maxLevelReached;

                for (let i = 1; i <= 10; i++) {
                    const btn = document.createElement('div');
                    btn.className = 'level-btn';
                    
                    // Solo permitir niveles alcanzados o inferiores
                    if (i <= this.maxLevelReached) {
                        btn.textContent = i;
                        
                        // Marcar nivel seleccionado
                        if (i === this.selectedLevel) {
                            btn.classList.add('selected');
                        }
                        
                        btn.onclick = () => {
                            this.selectedLevel = i;
                            this.renderLevelSelector();
                        };
                    } else {
                        btn.textContent = 'üîí';
                        btn.classList.add('locked');
                        const small = document.createElement('small');
                        small.textContent = `${i}-Back`;
                        btn.appendChild(document.createElement('br'));
                        btn.appendChild(small);
                    }

                    container.appendChild(btn);
                }
            },

            /**
             * INICIAR JUEGO CON NIVEL SELECCIONADO
             */
            startGameWithSelectedLevel() {
                if (!this.selectedLevel) {
                    alert('‚ö†Ô∏è Selecciona un nivel primero');
                    return;
                }

                // Desbloquear audio (cr√≠tico para m√≥viles)
                AudioEngine.unlock();

                this.showScreen('screen-game');

                // Delay para permitir transici√≥n de pantalla
                setTimeout(() => {
                    game.start(this.selectedLevel);
                }, 500);
            },

            /**
             * SALIR DEL JUEGO
             */
            quitGame() {
                if (confirm('¬øSeguro que deseas salir?\n\nSe perder√° el progreso de esta sesi√≥n.')) {
                    game.stop();
                    this.goHome();
                }
            },

            /**
             * CARGAR NIVEL M√ÅXIMO ALCANZADO
             */
            loadMaxLevel() {
                const history = this.getHistory();
                if (history.length > 0) {
                    // Buscar el nivel m√°s alto con precisi√≥n >= 85%
                    const successfulSessions = history.filter(s => s.accuracy >= 85);
                    if (successfulSessions.length > 0) {
                        const maxSuccessLevel = Math.max(...successfulSessions.map(s => s.level));
                        // Permitir intentar el siguiente nivel
                        this.maxLevelReached = Math.min(10, maxSuccessLevel + 1);
                    } else {
                        // Si nunca alcanz√≥ 85%, quedarse en nivel 1
                        this.maxLevelReached = 1;
                    }
                } else {
                    this.maxLevelReached = 1;
                }

                this.selectedLevel = this.maxLevelReached;
            },

            /**
             * CARGAR CONFIGURACI√ìN
             */
            loadConfig() {
                try {
                    const config = JSON.parse(localStorage.getItem('nback_config') || '{}');
                    game.config.zen = config.zen || false;
                    game.config.fast = config.fast || false;

                    document.getElementById('toggle-zen').checked = game.config.zen;
                    document.getElementById('toggle-fast').checked = game.config.fast;
                } catch (e) {
                    console.warn('Error cargando config:', e);
                }
            },

            /**
             * GUARDAR CONFIGURACI√ìN
             */
            saveConfig() {
                localStorage.setItem('nback_config', JSON.stringify({
                    zen: game.config.zen,
                    fast: game.config.fast
                }));
            },

            /**
             * TOGGLE MODO ZEN
             */
            toggleZen() {
                game.config.zen = document.getElementById('toggle-zen').checked;
                this.saveConfig();
                
                if (game.config.zen) {
                    console.log('üßò Modo Zen activado');
                } else {
                    console.log('üëÅÔ∏è Modo Zen desactivado');
                }
            },

            /**
             * TOGGLE MODO R√ÅPIDO
             */
            toggleFast() {
                game.config.fast = document.getElementById('toggle-fast').checked;
                this.saveConfig();
                
                if (game.config.fast) {
                    console.log('‚ö° Modo R√°pido activado (1500ms)');
                } else {
                    console.log('‚è±Ô∏è Modo Est√°ndar (3000ms)');
                }
            },

            /**
             * OBTENER HISTORIAL
             */
            getHistory() {
                try {
                    return JSON.parse(localStorage.getItem('nback_history') || '[]');
                } catch (e) {
                    console.error('Error leyendo historial:', e);
                    return [];
                }
            },

            /**
             * GUARDAR SESI√ìN
             */
            saveSession(sessionData) {
                try {
                    const history = this.getHistory();
                    history.push(sessionData);
                    localStorage.setItem('nback_history', JSON.stringify(history));
                    
                    // Actualizar nivel m√°ximo si corresponde
                    this.loadMaxLevel();
                    
                    console.log('üíæ Sesi√≥n guardada:', sessionData);
                } catch (e) {
                    console.error('Error guardando sesi√≥n:', e);
                }
            },

            /**
             * MOSTRAR RESULTADOS
             */
            showResults(data) {
                this.showScreen('screen-results');

                // Actualizar valores
                document.getElementById('result-accuracy').textContent = data.accuracy + '%';
                document.getElementById('result-level').textContent = data.level;
                document.getElementById('result-hits').textContent = data.hits;
                document.getElementById('result-errors').textContent = data.errors;

                // Veredicto basado en precisi√≥n
                const verdictDiv = document.getElementById('result-verdict');
                
                if (data.accuracy >= 85) {
                    verdictDiv.innerHTML = `
                        <div style="color: var(--success); font-size: 1.5rem; margin-bottom: 0.5rem;">üåü ¬°Excelente Desempe√±o!</div>
                        <p style="margin: 0;">Has alcanzado el umbral cl√≠nico del 85%. Tu cerebro ha demostrado neuroplasticidad efectiva.</p>
                    `;
                    verdictDiv.className = 'academic-box success-box';
                } else if (data.accuracy >= 70) {
                    verdictDiv.innerHTML = `
                        <div style="color: var(--warning); font-size: 1.5rem; margin-bottom: 0.5rem;">‚öñÔ∏è Buen Progreso</div>
                        <p style="margin: 0;">Est√°s consolidando el aprendizaje. Necesitas ‚â•85% para avanzar al siguiente nivel.</p>
                    `;
                    verdictDiv.className = 'academic-box';
                    verdictDiv.style.borderLeftColor = 'var(--warning)';
                    verdictDiv.style.background = '#fff3e0';
                } else {
                    verdictDiv.innerHTML = `
                        <div style="color: var(--error); font-size: 1.5rem; margin-bottom: 0.5rem;">üìâ Sobrecarga Cognitiva</div>
                        <p style="margin: 0;">Este nivel puede ser muy desafiante a√∫n. Considera practicar en un nivel inferior.</p>
                    `;
                    verdictDiv.className = 'academic-box';
                    verdictDiv.style.borderLeftColor = 'var(--error)';
                    verdictDiv.style.background = '#ffebee';
                }

                // Crear gr√°fico
                this.createResultChart(data);

                // Botones de acci√≥n
                const buttonsDiv = document.getElementById('result-buttons');
                buttonsDiv.innerHTML = '';

                // Si alcanz√≥ 85% y no est√° en nivel m√°ximo, ofrecer subir
                if (data.accuracy >= 85 && data.level < 10) {
                    const btnNext = document.createElement('button');
                    btnNext.className = 'btn btn-success';
                    btnNext.innerHTML = 'üöÄ Avanzar a Nivel ' + (data.level + 1);
                    btnNext.onclick = () => {
                        this.selectedLevel = data.level + 1;
                        this.maxLevelReached = Math.max(this.maxLevelReached, data.level + 1);
                        this.showScreen('screen-game');
                        setTimeout(() => game.start(this.selectedLevel), 500);
                    };
                    buttonsDiv.appendChild(btnNext);
                }

                // Repetir nivel
                const btnRetry = document.createElement('button');
                btnRetry.className = 'btn btn-warning';
                btnRetry.innerHTML = 'üîÑ Repetir Nivel ' + data.level;
                btnRetry.onclick = () => {
                    this.selectedLevel = data.level;
                    this.showScreen('screen-game');
                    setTimeout(() => game.start(this.selectedLevel), 500);
                };
                buttonsDiv.appendChild(btnRetry);

                // Elegir otro nivel
                const btnSelect = document.createElement('button');
                btnSelect.className = 'btn';
                btnSelect.innerHTML = 'üìä Elegir Nivel';
                btnSelect.onclick = () => this.showLevelSelector();
                buttonsDiv.appendChild(btnSelect);

                // Volver al men√∫
                const btnHome = document.createElement('button');
                btnHome.className = 'btn btn-secondary';
                btnHome.innerHTML = 'üè† Men√∫ Principal';
                btnHome.onclick = () => this.goHome();
                buttonsDiv.appendChild(btnHome);
            },

            /**
             * CREAR GR√ÅFICO DE RESULTADOS
             */
            createResultChart(data) {
                const ctx = document.getElementById('result-chart');
                
                // Destruir gr√°fico anterior si existe
                if (this.resultChart) {
                    this.resultChart.destroy();
                }

                const chartData = {
                    labels: ['Aciertos', 'Errores'],
                    datasets: [{
                        label: 'Rendimiento',
                        data: [data.hits, data.errors],
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(244, 67, 54, 0.8)'
                        ],
                        borderColor: [
                            'rgba(76, 175, 80, 1)',
                            'rgba(244, 67, 54, 1)'
                        ],
                        borderWidth: 2
                    }]
                };

                this.resultChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { size: 14, weight: 'bold' },
                                    padding: 20
                                }
                            },
                            title: {
                                display: true,
                                text: `Nivel ${data.level}-Back | Precisi√≥n: ${data.accuracy}%`,
                                font: { size: 16, weight: 'bold' }
                            }
                        }
                    }
                });
            },

            /**
             * MOSTRAR HISTORIAL
             */
            showHistoryForLevel(levelFilter) {
                const history = this.getHistory();
                
                // Filtrar por nivel si no es 'all'
                const filtered = levelFilter === 'all' ? 
                    history : 
                    history.filter(s => s.level === levelFilter);

                // Resumen estad√≠stico
                const summaryDiv = document.getElementById('history-summary');
                summaryDiv.innerHTML = '';

                if (history.length === 0) {
                    summaryDiv.innerHTML = '<p style="text-align: center; color: #999;">Sin datos de entrenamiento a√∫n.</p>';
                    document.getElementById('history-table-container').innerHTML = '';
                    return;
                }

                // Calcular estad√≠sticas generales
                const totalSessions = history.length;
                const avgAccuracy = Math.round(history.reduce((sum, s) => sum + s.accuracy, 0) / totalSessions);
                const maxLevel = Math.max(...history.map(s => s.level));
                const avgLatency = history.filter(s => s.avgLatency > 0).length > 0 ?
                    Math.round(history.filter(s => s.avgLatency > 0).reduce((sum, s) => sum + s.avgLatency, 0) / 
                    history.filter(s => s.avgLatency > 0).length) : 0;

                summaryDiv.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${totalSessions}</div>
                        <div class="stat-label">Sesiones</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${avgAccuracy}%</div>
                        <div class="stat-label">Precisi√≥n Media</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${maxLevel}</div>
                        <div class="stat-label">Nivel M√°ximo</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${avgLatency}ms</div>
                        <div class="stat-label">Latencia Media</div>
                    </div>
                `;

                // Crear gr√°fico de progreso
                this.createHistoryChart(filtered, levelFilter);

                // Crear tabla
                this.createHistoryTable(filtered);
            },

            /**
             * CREAR GR√ÅFICO DE HISTORIAL
             */
            createHistoryChart(sessions, levelFilter) {
                const ctx = document.getElementById('history-chart');
                
                // Destruir gr√°fico anterior
                if (this.historyChart) {
                    this.historyChart.destroy();
                }

                if (sessions.length === 0) {
                    ctx.parentElement.style.display = 'none';
                    return;
                }

                ctx.parentElement.style.display = 'block';

                // Preparar datos
                const labels = sessions.map((s, i) => `Sesi√≥n ${i + 1}`);
                const accuracyData = sessions.map(s => s.accuracy);
                const levelData = sessions.map(s => s.level);

                this.historyChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Precisi√≥n (%)',
                                data: accuracyData,
                                borderColor: 'rgba(76, 175, 80, 1)',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                borderWidth: 3,
                                tension: 0.3,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Nivel N-Back',
                                data: levelData,
                                borderColor: 'rgba(58, 123, 213, 1)',
                                backgroundColor: 'rgba(58, 123, 213, 0.1)',
                                borderWidth: 3,
                                tension: 0.3,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: { font: { size: 12, weight: 'bold' } }
                            },
                            title: {
                                display: true,
                                text: levelFilter === 'all' ? 
                                    'Progreso Global de Entrenamiento' : 
                                    `Progreso en Nivel ${levelFilter}-Back`,
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Precisi√≥n (%)',
                                    font: { weight: 'bold' }
                                },
                                min: 0,
                                max: 100
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Nivel',
                                    font: { weight: 'bold' }
                                },
                                min: 0,
                                max: 10,
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        }
                    }
                });
            },

            /**
             * CREAR TABLA DE HISTORIAL
             */
            createHistoryTable(sessions) {
                const container = document.getElementById('history-table-container');
                
                if (sessions.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #999; margin: 2rem 0;">No hay datos para este nivel.</p>';
                    return;
                }

                let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Nivel</th>
                                <th>Precisi√≥n</th>
                                <th>Aciertos</th>
                                <th>Errores</th>
                                <th>Latencia</th>
                                <th>Modo</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                sessions.slice().reverse().forEach(s => {
                    const date = new Date(s.date).toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });
                    
                    const accuracyColor = s.accuracy >= 85 ? '#4caf50' : 
                                         s.accuracy >= 70 ? '#ff9800' : '#f44336';
                    
                    const mode = s.mode === 'fast' ? '‚ö°' : '‚è±Ô∏è';
                    const zenBadge = s.zen ? '<small>üßò</small>' : '';

                    html += `
                        <tr>
                            <td>${date}</td>
                            <td style="text-align: center; font-weight: 700;">${s.level}</td>
                            <td style="text-align: center; font-weight: 700; color: ${accuracyColor};">${s.accuracy}%</td>
                            <td style="text-align: center;">${s.hits}</td>
                            <td style="text-align: center;">${s.errors}</td>
                            <td style="text-align: center;">${s.avgLatency || 0}ms</td>
                            <td style="text-align: center;">${mode} ${zenBadge}</td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                `;

                container.innerHTML = html;
            },

            /**
             * BORRAR HISTORIAL
             */
            clearHistory() {
                if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de borrar TODOS los datos de entrenamiento?\n\nEsta acci√≥n no se puede deshacer.')) {
                    if (confirm('Confirma nuevamente para borrar permanentemente el historial:')) {
                        localStorage.removeItem('nback_history');
                        this.maxLevelReached = 1;
                        this.selectedLevel = 1;
                        alert('‚úÖ Historial borrado completamente.');
                        this.showHistoryForLevel('all');
                    }
                }
            },

            /**
             * EXPORTAR DATOS
             */
            exportData() {
                try {
                    const history = this.getHistory();
                    const config = {
                        zen: game.config.zen,
                        fast: game.config.fast
                    };

                    const exportData = {
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        maxLevelReached: this.maxLevelReached,
                        config: config,
                        sessions: history
                    };

                    const dataStr = JSON.stringify(exportData, null, 2);
                    const blob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `DualNBack_Backup_${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);

                    alert('‚úÖ Datos exportados correctamente.');
                } catch (e) {
                    alert('‚ùå Error exportando datos: ' + e.message);
                }
            },

            /**
             * IMPORTAR DATOS
             */
            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validar estructura
                        if (!importedData.sessions || !Array.isArray(importedData.sessions)) {
                            throw new Error('Formato de archivo inv√°lido');
                        }

                        // Preguntar si sobrescribir o fusionar
                        const currentHistory = this.getHistory();
                        let action = 'merge';
                        
                        if (currentHistory.length > 0) {
                            action = confirm(
                                '¬øDeseas FUSIONAR los datos importados con los actuales?\n\n' +
                                'OK = Fusionar (mantener ambos)\n' +
                                'Cancelar = Reemplazar (borrar actuales)'
                            ) ? 'merge' : 'replace';
                        }

                        if (action === 'replace') {
                            localStorage.setItem('nback_history', JSON.stringify(importedData.sessions));
                        } else {
                            const merged = [...currentHistory, ...importedData.sessions];
                            // Ordenar por fecha
                            merged.sort((a, b) => new Date(a.date) - new Date(b.date));
                            localStorage.setItem('nback_history', JSON.stringify(merged));
                        }

                        // Actualizar nivel m√°ximo
                        this.loadMaxLevel();

                        alert(`‚úÖ Importaci√≥n exitosa.\n\nSesiones importadas: ${importedData.sessions.length}`);
                        
                        // Actualizar vista si est√° en historial
                        if (document.getElementById('screen-history').classList.contains('active')) {
                            this.showHistoryForLevel('all');
                        }
                    } catch (e) {
                        alert('‚ùå Error importando datos:\n\n' + e.message);
                    }
                };
                reader.readAsText(file);

                // Reset input
                event.target.value = '';
            },

            /**
             * TEST DE AUDIO
             */
            testAudio() {
                AudioEngine.unlock();
                
                const letters = ['C', 'H', 'K', 'L'];
                let index = 0;

                const playNext = () => {
                    if (index >= letters.length) {
                        alert('‚úÖ Test de audio completado.\n\n' +
                              'Si escuchaste las 4 letras claramente, el audio funciona correctamente.\n\n' +
                              'En iOS/Safari es OBLIGATORIO probar el audio antes de entrenar.');
                        return;
                    }

                    AudioEngine.speak(letters[index]);
                    index++;
                    setTimeout(playNext, 1500);
                };

                alert('üîä Reproduciendo 4 letras de prueba...\n\n' +
                      'Aseg√∫rate de tener el volumen adecuado.');
                
                setTimeout(playNext, 500);
            }
        };

        /**
         * INICIALIZAR APLICACI√ìN AL CARGAR
         */
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
        /**
         * UTILIDADES Y FUNCIONES AUXILIARES
         */

        // Prevenir zoom en iOS al hacer doble tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (event) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Prevenir pull-to-refresh en m√≥viles
        document.body.addEventListener('touchmove', (e) => {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // Mantener pantalla activa durante el juego
        let wakeLock = null;
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('üîí Wake Lock activado');
                }
            } catch (err) {
                console.warn('Wake Lock no disponible:', err);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release().then(() => {
                    wakeLock = null;
                    console.log('üîì Wake Lock liberado');
                });
            }
        }

        // Activar Wake Lock al iniciar juego
        const originalGameStart = game.start;
        game.start = function(level) {
            requestWakeLock();
            return originalGameStart.call(this, level);
        };

        // Liberar Wake Lock al terminar
        const originalGameFinish = game.finish;
        game.finish = function() {
            releaseWakeLock();
            return originalGameFinish.call(this);
        };

        const originalGameStop = game.stop;
        game.stop = function() {
            releaseWakeLock();
            return originalGameStop.call(this);
        };

        /**
         * MEJORAS DE RENDIMIENTO PARA DISPOSITIVOS ANTIGUOS
         */

        // Detectar dispositivo de baja potencia
        function isLowEndDevice() {
            // Heur√≠stica: < 4GB RAM o navigator.hardwareConcurrency < 4
            const memory = navigator.deviceMemory;
            const cores = navigator.hardwareConcurrency;
            
            return (memory && memory < 4) || (cores && cores < 4);
        }

        // Optimizar animaciones en dispositivos lentos
        if (isLowEndDevice()) {
            console.log('üì± Dispositivo de recursos limitados detectado - Optimizando...');
            
            // Reducir transiciones CSS
            const style = document.createElement('style');
            style.textContent = `
                * {
                    transition-duration: 0.1s !important;
                    animation-duration: 0.2s !important;
                }
            `;
            document.head.appendChild(style);
        }

        /**
         * MANEJO DE ERRORES Y RECUPERACI√ìN
         */

        // Guardar estado del juego peri√≥dicamente (por si hay crash)
        let autoSaveInterval = null;

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                if (game.isPlaying && game.sequence.length > 0) {
                    try {
                        const gameState = {
                            level: game.level,
                            round: game.currentRound,
                            stats: game.stats,
                            timestamp: Date.now()
                        };
                        sessionStorage.setItem('nback_recovery', JSON.stringify(gameState));
                    } catch (e) {
                        console.warn('Error en auto-guardado:', e);
                    }
                }
            }, 10000); // Cada 10 segundos
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
            sessionStorage.removeItem('nback_recovery');
        }

        // Verificar si hay sesi√≥n recuperable al cargar
        window.addEventListener('load', () => {
            try {
                const recovery = sessionStorage.getItem('nback_recovery');
                if (recovery) {
                    const state = JSON.parse(recovery);
                    const elapsed = Date.now() - state.timestamp;
                    
                    // Si fue hace menos de 5 minutos
                    if (elapsed < 300000) {
                        if (confirm('üîÑ Se detect√≥ una sesi√≥n interrumpida.\n\n¬øDeseas continuar donde lo dejaste?')) {
                            console.log('Sesi√≥n recuperada:', state);
                        }
                    }
                    sessionStorage.removeItem('nback_recovery');
                }
            } catch (e) {
                console.warn('Error verificando recuperaci√≥n:', e);
            }
        });

        // Iniciar auto-guardado cuando comienza el juego
        const originalStart = game.start;
        game.start = function(level) {
            startAutoSave();
            return originalStart.call(this, level);
        };

        // Detener auto-guardado cuando termina
        const originalFinish = game.finish;
        game.finish = function() {
            stopAutoSave();
            return originalFinish.call(this);
        };

        const originalStop = game.stop;
        game.stop = function() {
            stopAutoSave();
            return originalStop.call(this);
        };

        /**
         * ACCESIBILIDAD
         */

        // Soporte para lectores de pantalla (ARIA)
        document.addEventListener('DOMContentLoaded', () => {
            // Agregar roles ARIA a elementos interactivos
            document.querySelectorAll('.btn').forEach(btn => {
                if (!btn.getAttribute('role')) {
                    btn.setAttribute('role', 'button');
                }
            });

            // Anunciar cambios de pantalla
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'class') {
                        const screen = mutation.target;
                        if (screen.classList.contains('active')) {
                            const title = screen.querySelector('h1');
                            if (title) {
                                // Anunciar para lectores de pantalla
                                const announcement = document.createElement('div');
                                announcement.setAttribute('role', 'status');
                                announcement.setAttribute('aria-live', 'polite');
                                announcement.style.position = 'absolute';
                                announcement.style.left = '-9999px';
                                announcement.textContent = `Navegaste a: ${title.textContent}`;
                                document.body.appendChild(announcement);
                                
                                setTimeout(() => {
                                    document.body.removeChild(announcement);
                                }, 1000);
                            }
                        }
                    }
                });
            });

            document.querySelectorAll('.screen').forEach(screen => {
                observer.observe(screen, { attributes: true });
            });
        });

        /**
         * COMPATIBILIDAD CON NAVEGADORES ANTIGUOS
         */

        // Polyfill para Math.imul (usado en RNG)
        if (!Math.imul) {
            Math.imul = function(a, b) {
                const aHi = (a >>> 16) & 0xffff;
                const aLo = a & 0xffff;
                const bHi = (b >>> 16) & 0xffff;
                const bLo = b & 0xffff;
                return ((aLo * bLo) + (((aHi * bLo + aLo * bHi) << 16) >>> 0) | 0);
            };
        }

        // Detectar soporte de Chart.js
        window.addEventListener('load', () => {
            if (typeof Chart === 'undefined') {
                console.warn('‚ö†Ô∏è Chart.js no pudo cargar - Deshabilitando gr√°ficos');
                
                // Ocultar contenedores de gr√°ficos
                document.querySelectorAll('canvas').forEach(canvas => {
                    const container = canvas.parentElement;
                    if (container) {
                        container.innerHTML = '<p style="text-align: center; padding: 2rem; color: #999;">Los gr√°ficos no est√°n disponibles en este navegador.</p>';
                    }
                });
                
                // Redefinir funciones de gr√°ficos para que no fallen
                app.createResultChart = function() {};
                app.createHistoryChart = function() {};
            }
        });

        /**
         * MANEJO DE VISIBILIDAD DE P√ÅGINA
         */

        // Pausar el juego si el usuario cambia de pesta√±a/app
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && game.isPlaying) {
                console.log('‚è∏Ô∏è Juego pausado (pesta√±a oculta)');
                game.stop();
                
                if (confirm('‚è∏Ô∏è El juego se paus√≥ porque cambiaste de pesta√±a.\n\n¬øDeseas reiniciar la sesi√≥n?')) {
                    game.start(game.level);
                } else {
                    app.goHome();
                }
            }
        });

        /**
         * DETECCI√ìN DE ORIENTACI√ìN (Mobile)
         */

        window.addEventListener('orientationchange', () => {
            if (app.device === 'mobile') {
                setTimeout(() => {
                    // Reajustar layout
                    window.scrollTo(0, 0);
                    
                    // Notificar al usuario si est√° jugando
                    if (game.isPlaying) {
                        console.log('üîÑ Orientaci√≥n cambiada');
                    }
                }, 100);
            }
        });

        /**
         * LOGGING Y DEBUG (solo en desarrollo)
         */

        const DEBUG = window.location.hostname === 'localhost' || 
                     window.location.hostname === '127.0.0.1';

        if (DEBUG) {
            console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                   ‚ïë
‚ïë        üß† DUAL N-BACK PRO v1.0                   ‚ïë
‚ïë        Sistema de Entrenamiento Cognitivo        ‚ïë
‚ïë                                                   ‚ïë
‚ïë        Autor: Vicente Serey                      ‚ïë
‚ïë                                                   ‚ïë
‚ïë        Caracter√≠sticas:                          ‚ïë
‚ïë        ‚úÖ Input simult√°neo (pos + audio)         ‚ïë
‚ïë        ‚úÖ RNG avanzado (Mersenne Twister)        ‚ïë
‚ïë        ‚úÖ Modo Zen (validez ecol√≥gica)           ‚ïë
‚ïë        ‚úÖ Criterio cient√≠fico 85%                ‚ïë
‚ïë        ‚úÖ Selector manual de niveles             ‚ïë
‚ïë        ‚úÖ Anal√≠ticas separadas por nivel         ‚ïë
‚ïë        ‚úÖ Audio optimizado iOS/Android           ‚ïë
‚ïë        ‚úÖ Sin letras visibles en grid            ‚ïë
‚ïë                                                   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            `);

            // Exponer objetos globales para debug
            window.debugApp = app;
            window.debugGame = game;
            window.debugAudio = AudioEngine;

            // Log de eventos importantes
            const originalHandleInput = game.handleInput;
            game.handleInput = function(type) {
                console.log(`[INPUT] ${type.toUpperCase()} @ round ${this.currentRound}`);
                return originalHandleInput.call(this, type);
            };
        }

        /**
         * INFORMACI√ìN DE VERSI√ìN Y CR√âDITOS
         */

        const VERSION_INFO = {
            version: '1.0.0',
            buildDate: '2025-12-19',
            author: 'Vicente Serey',
            license: 'Educational Use',
            features: [
                'Generador aleatorio avanzado (Mersenne Twister)',
                'Input simult√°neo (posici√≥n + audio)',
                'Modo Zen para entrenamiento puro',
                'Criterio cient√≠fico de avance (85%)',
                'Selector de nivel con restricci√≥n l√≥gica',
                'Anal√≠ticas separadas por nivel',
                'Audio optimizado para iOS/Safari/Android',
                'Grid sin letras visibles (Dual N-Back puro)',
                'Soporte completo para m√≥viles y escritorio',
                'Persistencia de datos con import/export',
                'Gr√°ficos interactivos con Chart.js',
                'Wake Lock para mantener pantalla activa',
                'Auto-guardado y recuperaci√≥n de sesiones'
            ]
        };

        console.log('üìã Informaci√≥n del Sistema:', VERSION_INFO);
        /**
         * SISTEMA DE LOGROS (MOTIVACI√ìN ADICIONAL)
         */

        const achievements = {
            // Definir logros
            list: [
                { id: 'first_session', name: 'Primera Sesi√≥n', desc: 'Completar tu primera sesi√≥n', icon: 'üéØ' },
                { id: 'level_3', name: 'Veterano', desc: 'Alcanzar nivel 3-Back', icon: 'ü•â' },
                { id: 'level_5', name: 'Experto', desc: 'Alcanzar nivel 5-Back', icon: 'ü•à' },
                { id: 'level_7', name: 'Maestro', desc: 'Alcanzar nivel 7-Back', icon: 'ü•á' },
                { id: 'level_10', name: 'Leyenda', desc: 'Alcanzar nivel 10-Back', icon: 'üëë' },
                { id: 'perfect_session', name: 'Perfecci√≥n', desc: 'Sesi√≥n con 100% precisi√≥n', icon: 'üíØ' },
                { id: 'streak_5', name: 'Consistente', desc: '5 sesiones consecutivas', icon: 'üî•' },
                { id: 'streak_10', name: 'Disciplinado', desc: '10 sesiones consecutivas', icon: '‚ö°' },
                { id: 'total_50', name: 'Comprometido', desc: '50 sesiones completadas', icon: 'üí™' }
            ],

            // Verificar logros
            check() {
                const history = app.getHistory();
                const unlocked = JSON.parse(localStorage.getItem('nback_achievements') || '[]');
                const newUnlocks = [];

                // Primera sesi√≥n
                if (history.length >= 1 && !unlocked.includes('first_session')) {
                    newUnlocks.push('first_session');
                }

                // Niveles alcanzados
                const maxLevel = Math.max(...history.map(s => s.level));
                if (maxLevel >= 3 && !unlocked.includes('level_3')) newUnlocks.push('level_3');
                if (maxLevel >= 5 && !unlocked.includes('level_5')) newUnlocks.push('level_5');
                if (maxLevel >= 7 && !unlocked.includes('level_7')) newUnlocks.push('level_7');
                if (maxLevel >= 10 && !unlocked.includes('level_10')) newUnlocks.push('level_10');

                // Sesi√≥n perfecta
                if (history.some(s => s.accuracy === 100) && !unlocked.includes('perfect_session')) {
                    newUnlocks.push('perfect_session');
                }

                // Rachas
                const streak = calculateCurrentStreak(history);
                if (streak >= 5 && !unlocked.includes('streak_5')) newUnlocks.push('streak_5');
                if (streak >= 10 && !unlocked.includes('streak_10')) newUnlocks.push('streak_10');

                // Total sesiones
                if (history.length >= 50 && !unlocked.includes('total_50')) newUnlocks.push('total_50');

                // Guardar nuevos logros
                if (newUnlocks.length > 0) {
                    const updated = [...unlocked, ...newUnlocks];
                    localStorage.setItem('nback_achievements', JSON.stringify(updated));
                    this.show(newUnlocks);
                }
            },

            // Mostrar logros desbloqueados
            show(ids) {
                ids.forEach(id => {
                    const achievement = this.list.find(a => a.id === id);
                    if (achievement) {
                        this.displayNotification(achievement);
                    }
                });
            },

            // Notificaci√≥n visual
            displayNotification(achievement) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 80px;
                    right: 20px;
                    background: linear-gradient(135deg, #4caf50, #66bb6a);
                    color: white;
                    padding: 20px;
                    border-radius: 16px;
                    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
                    z-index: 10000;
                    min-width: 280px;
                    animation: slideInRight 0.5s ease-out;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
                `;

                notification.innerHTML = `
                    <div style="font-size: 2.5rem; text-align: center; margin-bottom: 10px;">${achievement.icon}</div>
                    <div style="font-size: 1.2rem; font-weight: bold; text-align: center; margin-bottom: 5px;">
                        ¬°Logro Desbloqueado!
                    </div>
                    <div style="font-size: 1rem; font-weight: 600; text-align: center; margin-bottom: 3px;">
                        ${achievement.name}
                    </div>
                    <div style="font-size: 0.85rem; text-align: center; opacity: 0.9;">
                        ${achievement.desc}
                    </div>
                `;

                document.body.appendChild(notification);

                // Sonido de celebraci√≥n (si el audio est√° habilitado)
                if (AudioEngine.ctx) {
                    const osc1 = AudioEngine.ctx.createOscillator();
                    const osc2 = AudioEngine.ctx.createOscillator();
                    const gain = AudioEngine.ctx.createGain();

                    osc1.frequency.value = 523.25; // C5
                    osc2.frequency.value = 659.25; // E5
                    gain.gain.value = 0.1;

                    osc1.connect(gain);
                    osc2.connect(gain);
                    gain.connect(AudioEngine.ctx.destination);

                    const now = AudioEngine.ctx.currentTime;
                    osc1.start(now);
                    osc2.start(now + 0.1);
                    osc1.stop(now + 0.2);
                    osc2.stop(now + 0.3);
                }

                // Remover despu√©s de 5 segundos
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.5s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 500);
                }, 5000);
            }
        };

        function calculateCurrentStreak(history) {
            let streak = 0;
            for (let i = history.length - 1; i >= 0; i--) {
                if (history[i].accuracy >= 70) {
                    streak++;
                } else {
                    break;
                }
            }
            return streak;
        }

        // Verificar logros al guardar sesi√≥n
        const originalSaveSession = app.saveSession;
        app.saveSession = function(sessionData) {
            const result = originalSaveSession.call(this, sessionData);
            
            // Verificar logros despu√©s de un peque√±o delay
            setTimeout(() => {
                achievements.check();
            }, 1000);
            
            return result;
        };

        /**
         * EASTER EGG: C√≥digo Konami para estad√≠sticas avanzadas
         */

        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 
                                'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

        document.addEventListener('keydown', (e) => {
            konamiCode.push(e.key);
            konamiCode = konamiCode.slice(-10);

            if (konamiCode.join(',') === konamiSequence.join(',')) {
                console.log('üéÆ C√ìDIGO KONAMI ACTIVADO');
                
                const history = app.getHistory();
                if (history.length === 0) {
                    alert('üìä Sin datos para mostrar estad√≠sticas avanzadas.');
                    return;
                }

                // Calcular estad√≠sticas avanzadas
                const totalSessions = history.length;
                const avgAcc = (history.reduce((s, h) => s + h.accuracy, 0) / totalSessions).toFixed(2);
                const maxStreak = calculateMaxStreak(history);
                const timeSpent = totalSessions * 20 * 3; // aprox segundos
                
                alert(`üéØ ESTAD√çSTICAS AVANZADAS DEL ENTRENADOR\n\n` +
                      `üìä Total sesiones: ${totalSessions}\n` +
                      `üìà Precisi√≥n media: ${avgAcc}%\n` +
                      `üî• Racha m√°xima: ${maxStreak} sesiones consecutivas\n` +
                      `‚è±Ô∏è Tiempo total: ~${Math.round(timeSpent / 60)} minutos\n` +
                      `üß† Nivel m√°ximo: ${app.maxLevelReached}\n\n` +
                      `¬°Sigue entrenando tu mente! üí™`);
            }
        });

        function calculateMaxStreak(history) {
            let maxStreak = 0;
            let currentStreak = 0;
            
            history.forEach(session => {
                if (session.accuracy >= 70) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            });
            
            return maxStreak;
        }

        /**
         * PROTECCI√ìN CONTRA ERRORES CR√çTICOS
         */

        window.addEventListener('error', (event) => {
            console.error('‚ùå Error cr√≠tico capturado:', event.error);
            
            // Si hay un error durante el juego, intentar guardar el estado
            if (game.isPlaying) {
                try {
                    stopAutoSave();
                    game.stop();
                } catch (e) {
                    console.error('Error al detener juego:', e);
                }
            }

            // No mostrar alertas en producci√≥n para no molestar al usuario
            if (DEBUG) {
                alert('‚ö†Ô∏è Error detectado. Revisa la consola para m√°s detalles.');
            }
        });

        // Capturar promesas rechazadas
        window.addEventListener('unhandledrejection', (event) => {
            console.error('‚ùå Promesa rechazada:', event.reason);
            event.preventDefault();
        });

        /**
         * MENSAJE DE CONSOLA FINAL
         */

        console.log('%c¬°Bienvenido al Dual N-Back Pro! üß†', 
                   'color: #3a7bd5; font-size: 20px; font-weight: bold;');
        console.log('%cEste sistema fue dise√±ado para entrenar tu memoria de trabajo de manera cient√≠fica.', 
                   'color: #666; font-size: 12px;');
        console.log('%c\nüí° Consejo: Entrena 20-25 minutos diarios para mejores resultados.\n', 
                   'color: #4caf50; font-size: 14px; font-weight: bold;');

        /**
         * MENSAJE ESPECIAL DE MOTIVACI√ìN
         */

        setTimeout(() => {
            if (app.getHistory().length === 0) {
                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #2196f3');
                console.log('%c  üåü BIENVENIDO A TU PRIMER ENTRENAMIENTO üåü  ', 'color: #2196f3; font-weight: bold; font-size: 14px;');
                console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #2196f3');
                console.log('');
                console.log('La memoria de trabajo es el "procesador" de tu mente.');
                console.log('Con pr√°ctica constante, ver√°s mejoras en:');
                console.log('  ‚úì Atenci√≥n sostenida');
                console.log('  ‚úì Capacidad de concentraci√≥n');
                console.log('  ‚úì Resoluci√≥n de problemas');
                console.log('  ‚úì Aprendizaje de nueva informaci√≥n');
                console.log('');
                console.log('Recuerda: La neuroplasticidad requiere consistencia.');
                console.log('Entrena 20-25 minutos diarios durante 8-12 semanas.');
                console.log('');
                console.log('%c¬°T√∫ puedes! üí™üß†', 'color: #4caf50; font-weight: bold; font-size: 16px;');
                console.log('');
            }
        }, 2000);

        /**
         * MEJORAS DE UX Y FEEDBACK ADICIONAL
         */

        // Animaci√≥n de carga inicial
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.body.style.opacity = '1';
            }, 100);
        });

        // Prevenir cierre accidental durante el juego
        window.addEventListener('beforeunload', (e) => {
            if (game.isPlaying) {
                e.preventDefault();
                e.returnValue = '¬øEst√°s seguro de salir? Perder√°s el progreso de esta sesi√≥n.';
                return e.returnValue;
            }
        });

        /**
         * OPTIMIZACI√ìN DE RENDIMIENTO ADICIONAL
         */

        // Lazy loading de gr√°ficos (solo cargar cuando sea necesario)
        let chartsLoaded = false;

        function ensureChartsLoaded() {
            if (chartsLoaded) return Promise.resolve();
            
            return new Promise((resolve) => {
                if (typeof Chart !== 'undefined') {
                    chartsLoaded = true;
                    resolve();
                } else {
                    // Si Chart.js no se carg√≥, esperar un poco m√°s
                    setTimeout(() => {
                        if (typeof Chart !== 'undefined') {
                            chartsLoaded = true;
                            resolve();
                        } else {
                            console.warn('Chart.js no disponible');
                            resolve();
                        }
                    }, 1000);
                }
            });
        }

        // Optimizar creaci√≥n de gr√°ficos
        const originalCreateResultChart = app.createResultChart;
        app.createResultChart = async function(data) {
            await ensureChartsLoaded();
            if (typeof Chart !== 'undefined') {
                return originalCreateResultChart.call(this, data);
            }
        };

        const originalCreateHistoryChart = app.createHistoryChart;
        app.createHistoryChart = async function(sessions, levelFilter) {
            await ensureChartsLoaded();
            if (typeof Chart !== 'undefined') {
                return originalCreateHistoryChart.call(this, sessions, levelFilter);
            }
        };

        /**
         * MEJORAS DE AUDIO PARA EDGE CASES
         */

        // Reintentar audio si falla (com√∫n en m√≥viles antiguos)
        const originalSpeak = AudioEngine.speak;
        AudioEngine.speak = function(letter) {
            try {
                originalSpeak.call(this, letter);
            } catch (e) {
                console.warn('Error en audio, reintentando...', e);
                
                // Reintentar despu√©s de un peque√±o delay
                setTimeout(() => {
                    try {
                        this.unlock();
                        originalSpeak.call(this, letter);
                    } catch (e2) {
                        console.error('Audio fall√≥ completamente:', e2);
                        // Fallback: solo tono
                        this.playTone(letter);
                    }
                }, 100);
            }
        };
        /**
         * MEJORAS FINALES Y AJUSTES
         */

        // Agregar animaciones CSS din√°micas
        const styleSheet = document.createElement('style');
        styleSheet.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }

            @keyframes pulse {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }

            @keyframes correctFeedback {
                0% {
                    box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
                }
                100% {
                    box-shadow: 0 0 0 20px rgba(76, 175, 80, 0);
                }
            }

            @keyframes errorFeedback {
                0% {
                    box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7);
                }
                100% {
                    box-shadow: 0 0 0 20px rgba(244, 67, 54, 0);
                }
            }

            .cell.correct-feedback {
                animation: correctFeedback 0.6s ease-out;
            }

            .cell.error-feedback {
                animation: errorFeedback 0.6s ease-out;
            }
        `;
        document.head.appendChild(styleSheet);

        /**
         * FUNCI√ìN PARA COMPARTIR RESULTADOS (Social Share)
         */

        function shareResults(sessionData) {
            const text = `üß† Dual N-Back Training\n\n` +
                        `üìä Nivel: ${sessionData.level}-Back\n` +
                        `üéØ Precisi√≥n: ${sessionData.accuracy}%\n` +
                        `‚úÖ Aciertos: ${sessionData.hits}\n` +
                        `‚ùå Errores: ${sessionData.errors}\n\n` +
                        `#NBackTraining #CognitiveTraining #Neuroplasticity`;

            // Intentar usar Web Share API (m√≥viles modernos)
            if (navigator.share) {
                navigator.share({
                    title: 'Mis resultados de Dual N-Back',
                    text: text
                }).catch(err => {
                    console.log('Share cancelado:', err);
                });
            } else {
                // Fallback: copiar al portapapeles
                navigator.clipboard.writeText(text).then(() => {
                    alert('‚úÖ Resultados copiados al portapapeles.\n\nPuedes pegarlos donde quieras compartirlos.');
                }).catch(() => {
                    alert('üìã Resultados:\n\n' + text);
                });
            }
        }

        // Agregar bot√≥n de compartir en resultados
        window.addEventListener('load', () => {
            const originalShowResults = app.showResults;
            app.showResults = function(data) {
                originalShowResults.call(this, data);

                // Agregar bot√≥n de compartir
                const buttonsDiv = document.getElementById('result-buttons');
                if (buttonsDiv) {
                    const shareBtn = document.createElement('button');
                    shareBtn.className = 'btn btn-secondary';
                    shareBtn.innerHTML = 'üì§ Compartir Resultados';
                    shareBtn.style.marginTop = '10px';
                    shareBtn.onclick = () => shareResults(data);
                    buttonsDiv.appendChild(shareBtn);
                }
            };
        });

        /**
         * TIPS Y CONSEJOS CONTEXTUALES
         */

        const tips = [
            'Mant√©n tu atenci√≥n distribuida entre posici√≥n y sonido por igual.',
            'No te desanimes si fallas. La neuroplasticidad toma tiempo.',
            'Practica en un ambiente tranquilo y sin distracciones.',
            'La consistencia es m√°s importante que la intensidad.',
            'Respira profundo antes de cada sesi√≥n para centrarte.',
            'Si un nivel es muy dif√≠cil, baja un nivel y consolida.',
            'Los estudios muestran mejoras despu√©s de 8-12 semanas.',
            'Tu memoria de trabajo es entrenable, como un m√∫sculo.',
            'No adivines. Solo responde cuando est√©s seguro.',
            'Descansa bien. El sue√±o consolida el aprendizaje.'
        ];

        function getRandomTip() {
            return tips[Math.floor(Math.random() * tips.length)];
        }

        // Mostrar tip aleatorio al volver al men√∫
        const originalGoHome = app.goHome;
        app.goHome = function() {
            originalGoHome.call(this);
            
            // Solo mostrar tip si ya complet√≥ al menos una sesi√≥n
            if (app.getHistory().length > 0 && Math.random() > 0.5) {
                setTimeout(() => {
                    const tipDiv = document.createElement('div');
                    tipDiv.style.cssText = `
                        position: fixed;
                        bottom: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: rgba(58, 123, 213, 0.95);
                        color: white;
                        padding: 15px 25px;
                        border-radius: 12px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                        max-width: 90%;
                        z-index: 9999;
                        font-size: 14px;
                        text-align: center;
                    `;
                    tipDiv.innerHTML = `üí° <strong>Tip:</strong> ${getRandomTip()}`;
                    document.body.appendChild(tipDiv);

                    setTimeout(() => {
                        tipDiv.style.opacity = '0';
                        tipDiv.style.transition = 'opacity 0.5s';
                        setTimeout(() => {
                            if (tipDiv.parentNode) {
                                document.body.removeChild(tipDiv);
                            }
                        }, 500);
                    }, 5000);
                }, 1000);
            }
        };

        /**
         * VERIFICACI√ìN DE INTEGRIDAD DE DATOS
         */

        function validateHistory() {
            try {
                const history = app.getHistory();
                const valid = history.every(session => {
                    return session.level && 
                           typeof session.accuracy === 'number' && 
                           session.hits !== undefined && 
                           session.errors !== undefined &&
                           session.date;
                });

                if (!valid) {
                    console.warn('‚ö†Ô∏è Historial corrupto detectado');
                    if (confirm('Se detectaron datos corruptos en el historial.\n\n¬øDeseas limpiar los datos inv√°lidos?')) {
                        const cleaned = history.filter(s => {
                            return s.level && typeof s.accuracy === 'number' && s.date;
                        });
                        localStorage.setItem('nback_history', JSON.stringify(cleaned));
                        alert('‚úÖ Datos limpiados correctamente.');
                        location.reload();
                    }
                }
            } catch (e) {
                console.error('Error validando historial:', e);
            }
        }

        // Validar al iniciar
        window.addEventListener('load', () => {
            setTimeout(validateHistory, 2000);
        });

        /**
         * MODO OSCURO (Bonus Feature)
         */

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('nback_darkmode', isDark);
        }

        // Cargar preferencia de modo oscuro
        window.addEventListener('load', () => {
            const darkMode = localStorage.getItem('nback_darkmode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
            }

            // Agregar estilos de modo oscuro
            if (darkMode) {
                const darkStyle = document.createElement('style');
                darkStyle.textContent = `
                    .dark-mode {
                        background: #1a1a1a !important;
                        color: #e0e0e0 !important;
                    }
                    .dark-mode .app-container {
                        background: #2d2d2d !important;
                    }
                    .dark-mode .screen {
                        background: #2d2d2d !important;
                        color: #e0e0e0 !important;
                    }
                    .dark-mode .card {
                        background: #383838 !important;
                        border-color: #555 !important;
                    }
                    .dark-mode .academic-box {
                        background: #383838 !important;
                        color: #e0e0e0 !important;
                    }
                    .dark-mode .btn {
                        background: #555 !important;
                        color: #fff !important;
                    }
                `;
                document.head.appendChild(darkStyle);
            }
        });

        /**
         * FINALIZACI√ìN Y EXPORTS
         */

        console.log('‚úÖ Sistema completamente inicializado');
        console.log('üì¶ M√≥dulos cargados: AudioEngine, Game, App, Achievements');
        console.log('üéÆ Estado: Listo para entrenar');

        // Exponer API p√∫blica para extensiones futuras
        window.DualNBackApp = {
            version: VERSION_INFO.version,
            app: app,
            game: game,
            audio: AudioEngine,
            achievements: achievements,
            
            // M√©todos p√∫blicos √∫tiles
            exportData: () => app.exportData(),
            clearHistory: () => app.clearHistory(),
            getStats: () => {
                const history = app.getHistory();
                return {
                    totalSessions: history.length,
                    avgAccuracy: history.length > 0 ? 
                        Math.round(history.reduce((s, h) => s + h.accuracy, 0) / history.length) : 0,
                    maxLevel: app.maxLevelReached,
                    currentStreak: calculateCurrentStreak(history)
                };
            },
            
            // Utilidades de debug
            debug: {
                simulateSession: (level, accuracy) => {
                    const mockSession = {
                        date: new Date().toISOString(),
                        level: level,
                        accuracy: accuracy,
                        hits: Math.round(20 * accuracy / 100),
                        errors: 20 - Math.round(20 * accuracy / 100),
                        avgLatency: 500 + Math.random() * 500,
                        mode: game.config.fast ? 'fast' : 'standard',
                        zen: game.config.zen
                    };
                    app.saveSession(mockSession);
                    console.log('Sesi√≥n simulada guardada:', mockSession);
                },
                
                resetProgress: () => {
                    if (confirm('‚ö†Ô∏è ADVERTENCIA: Esto borrar√° TODO el progreso.\n\n¬øConfirmar?')) {
                        localStorage.clear();
                        sessionStorage.clear();
                        location.reload();
                    }
                }
            }
        };

        // Log final
        console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #4caf50');
        console.log('%c  ‚úÖ DUAL N-BACK PRO - COMPLETAMENTE CARGADO  ', 'color: #4caf50; font-weight: bold; font-size: 14px;');
        console.log('%c‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'color: #4caf50');
        console.log('');
        console.log('üí° Accede a la API p√∫blica con: window.DualNBackApp');
        console.log('üìä Ver estad√≠sticas: DualNBackApp.getStats()');
        console.log('üíæ Exportar datos: DualNBackApp.exportData()');
        console.log('');

    </script>
</body>
</html>
